<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DuckDB WASM Test Page</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        .status-indicator {
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
            font-weight: 500;
        }
        .status-loading {
            background: rgba(255,193,7,0.2);
            border: 2px solid #ffc107;
        }
        .status-success {
            background: rgba(40,167,69,0.2);
            border: 2px solid #28a745;
        }
        .status-error {
            background: rgba(220,53,69,0.2);
            border: 2px solid #dc3545;
        }
        .test-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .console-output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ DuckDB WASM Integration Test</h1>
        <p>–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é DuckDB WASM –¥–ª—è MaxPilot.</p>
        
        <div id="status" class="status-indicator status-loading">
            üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ DuckDB WASM...
        </div>

        <div>
            <button class="test-button" onclick="runBasicTest()">üîß Basic Test</button>
            <button class="test-button" onclick="runPerformanceTest()">‚ö° Performance Test</button>
            <button class="test-button" onclick="runCompatibilityTest()">üåê Compatibility Test</button>
            <button class="test-button" onclick="clearConsole()">üóëÔ∏è Clear Console</button>
        </div>

        <div id="console-output" class="console-output">
            –ö–æ–Ω—Å–æ–ª—å –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é...\n
        </div>
    </div>

    <script>
        // Override console.log to show in our console
        const originalConsoleLog = console.log;
        const originalConsoleError = console.error;
        const consoleOutput = document.getElementById('console-output');
        
        function addToConsole(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'warn' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            consoleOutput.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalConsoleLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalConsoleError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };

        // Test functions
        async function runBasicTest() {
            console.log('üîß Starting Basic DuckDB Test...');
            
            try {
                // Test WebAssembly support
                if (typeof WebAssembly === 'undefined') {
                    throw new Error('WebAssembly not supported');
                }
                console.log('‚úÖ WebAssembly supported');
                
                // Test dynamic imports
                try {
                    await import('data:text/javascript,export default 1');
                    console.log('‚úÖ Dynamic imports supported');
                } catch (e) {
                    console.log('‚ö†Ô∏è Dynamic imports not supported, will use fallback');
                }
                
                // Test fetch to CDN
                const response = await fetch('https://cdn.jsdelivr.net/npm/@duckdb/duckdb-wasm@latest/package.json');
                if (response.ok) {
                    console.log('‚úÖ CDN accessible');
                } else {
                    throw new Error('CDN not accessible');
                }
                
                console.log('üéâ Basic test completed successfully!');
                updateStatus('‚úÖ Basic test passed', 'success');
                
            } catch (error) {
                console.error('‚ùå Basic test failed:', error.message);
                updateStatus('‚ùå Basic test failed', 'error');
            }
        }

        async function runPerformanceTest() {
            console.log('‚ö° Starting Performance Test...');
            
            try {
                const sizes = [100, 500, 1000];
                
                for (const size of sizes) {
                    const startTime = performance.now();
                    
                    // Simulate data generation
                    const data = [];
                    for (let i = 0; i < size; i++) {
                        data.push([i, `item${i}`, Math.random() * 1000]);
                    }
                    
                    // Simulate hash calculation (like DuckDB would do)
                    const hashes = data.map(row => {
                        return row.join('|').split('').reduce((a, b) => {
                            a = ((a << 5) - a) + b.charCodeAt(0);
                            return a & a;
                        }, 0);
                    });
                    
                    const duration = performance.now() - startTime;
                    console.log(`üìä ${size} rows processed in ${duration.toFixed(2)}ms`);
                }
                
                console.log('üéâ Performance test completed!');
                updateStatus('‚úÖ Performance test passed', 'success');
                
            } catch (error) {
                console.error('‚ùå Performance test failed:', error.message);
                updateStatus('‚ùå Performance test failed', 'error');
            }
        }

        async function runCompatibilityTest() {
            console.log('üåê Starting Compatibility Test...');
            
            try {
                const features = {
                    'WebAssembly': typeof WebAssembly !== 'undefined',
                    'Worker': typeof Worker !== 'undefined',
                    'SharedArrayBuffer': typeof SharedArrayBuffer !== 'undefined',
                    'BigInt': typeof BigInt !== 'undefined',
                    'Fetch API': typeof fetch !== 'undefined',
                    'Promise': typeof Promise !== 'undefined',
                    'Async/Await': true // If we got here, it's supported
                };
                
                console.log('üîç Browser Features:');
                Object.entries(features).forEach(([feature, supported]) => {
                    const status = supported ? '‚úÖ' : '‚ùå';
                    console.log(`  ${status} ${feature}: ${supported ? 'Supported' : 'Not supported'}`);
                });
                
                const supportedCount = Object.values(features).filter(Boolean).length;
                const totalCount = Object.keys(features).length;
                
                console.log(`\nüìà Compatibility Score: ${supportedCount}/${totalCount} (${((supportedCount/totalCount)*100).toFixed(1)}%)`);
                
                if (supportedCount >= 6) {
                    console.log('üéâ Browser fully compatible with DuckDB WASM!');
                    updateStatus('‚úÖ Browser fully compatible', 'success');
                } else {
                    console.log('‚ö†Ô∏è Limited compatibility, fallback mode recommended');
                    updateStatus('‚ö†Ô∏è Limited compatibility', 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Compatibility test failed:', error.message);
                updateStatus('‚ùå Compatibility test failed', 'error');
            }
        }

        function clearConsole() {
            consoleOutput.textContent = '–ö–æ–Ω—Å–æ–ª—å –æ—á–∏—â–µ–Ω–∞...\n';
        }

        function updateStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status-indicator status-${type}`;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ DuckDB Test Page loaded');
            console.log('üìù Click buttons above to run tests');
            
            // Auto-run compatibility test
            setTimeout(() => {
                runCompatibilityTest();
            }, 1000);
        });
    </script>
</body>
</html>
